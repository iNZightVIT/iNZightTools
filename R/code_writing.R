as_call <- function(x) {
    if (inherits(x, "formula")) {
        stopifnot(length(x) == 2)
        x[[2]]
    } else if (is.atomic(x) || is.name(x) || is.call(x)) {
        x
    } else {
        stop("Unknown input")
    }
}


interpolate <- function(code, ..., `_env` = parent.frame()) {
    if (length(list(...)) > 0) {
        args <- lapply(list(...), as_call)
        expr <- methods::substituteDirect(as_call(code), args)
    } else {
        expr <- as_call(code)
    }
    res <- eval(expr, `_env`)
    attr(res, "code") <- capture.output(expr)
    res
}


##' Used to grab code from a data.frame generated by this package.
##'
##' This is simply a helper function to grab the contents
##' of the `code` attribute contained in the data object.
##'
##' @title Get Data's Code
##' @param data dataset you want to extract the code from
##' @return The code used to generate the data.frame, if available (else NULL) 
##' @author Tom Elliott
##' @export
code <- function(data) return(attr(data, "code"))
